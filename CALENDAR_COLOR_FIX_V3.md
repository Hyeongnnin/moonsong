# 캘린더 주황색 표시 문제 해결 (v3 최종)

## 문제 증상
- 11월 근로기록을 삭제했는데도 여전히 주황색 날짜가 표시됨
- "삭제할 데이터가 없습니다" 메시지가 나오지만 캘린더는 변하지 않음
- 통계는 업데이트되지만 캘린더 색상은 그대로

## 근본 원인

### 기존 로직
```python
# monthly_scheduled_dates() 함수
if 실제_근로기록:
    주황색 표시
elif 스케줄_설정됨:
    주황색 표시  # ← 이게 문제!
```

**문제점**: 
- 실제 근로기록을 삭제해도 주간 스케줄이 남아있으면 주황색으로 표시
- 사용자 입장: "삭제했는데 왜 주황색이 남아있지?"

### 예시
```
근로정보 수정에서 목, 금, 토 근무 스케줄 설정
↓
11월 5, 7, 12, 14... 주황색으로 표시 (스케줄 기반)
↓
11월 근로기록 삭제
↓
여전히 주황색! (스케줄이 남아있음)
```

---

## 해결 방법 (v3)

### 변경된 로직
```python
# monthly_scheduled_dates() 함수 (v3)
if 실제_근로기록 AND 시간 > 0:
    주황색 표시
else:
    흰색 표시
# 스케줄 확인 로직 완전 제거!
```

### 수정 코드
**파일**: `labor/services.py`

```python
def monthly_scheduled_dates(employee, year, month):
    """
    v3: 실제 근로기록만 표시
    """
    # 실제 근무 기록만 가져오기
    work_records = WorkRecord.objects.filter(
        employee=employee,
        work_date__year=year,
        work_date__month=month
    )
    
    worked_records_map = {wr.work_date: wr for wr in work_records}
    
    for dt in month_dates:
        is_scheduled = False
        
        # 실제 근로기록만 확인
        if dt in worked_records_map:
            record = worked_records_map[dt]
            if record.get_total_hours() > 0:
                is_scheduled = True  # 주황색
        
        # 스케줄 확인 로직 제거됨!
        
        scheduled_dates_data.append({
            "date": dt.isoformat(),
            "is_scheduled": is_scheduled,
        })
    
    return scheduled_dates_data
```

---

## 효과

### Before (v2)
```
캘린더 색상 = 실제 기록 OR 월별 스케줄 OR 주간 스케줄
↓
삭제 후: 스케줄 기반 색상 남음 (혼란스러움)
```

### After (v3)
```
캘린더 색상 = 실제 기록만
↓
삭제 후: 즉시 흰색으로 변경 (명확함)
```

---

## 사용자 시나리오

### 1. 근로기록 입력 전
```
캘린더: 모두 흰색
- 스케줄만 설정해도 흰색 유지
- 명확한 시각적 피드백
```

### 2. 근로기록 입력 후
```
11월 5일 근무: 6시간 입력
↓
캘린더: 11월 5일만 주황색
```

### 3. 근로기록 삭제 후
```
11월 데이터 삭제
↓
캘린더: 즉시 모두 흰색으로 변경 ✅
통계: 즉시 0으로 업데이트 ✅
```

---

## 변경사항 요약

| 항목 | Before (v2) | After (v3) |
|------|-------------|------------|
| 캘린더 색상 기준 | 실제 기록 + 스케줄 | 실제 기록만 |
| 스케줄만 설정 시 | 주황색 | 흰색 |
| 삭제 후 색상 | 스케줄 남음 (혼란) | 즉시 흰색 (명확) |
| 사용자 이해도 | 낮음 | 높음 |

---

## 철학적 변경

### 기존 (v2)
"스케줄이 있으면 주황색으로 표시하자"
- 예상 근무일을 미리 보여줌
- 하지만: 실제와 예상이 섞여 혼란

### 현재 (v3)
"실제로 일한 날만 주황색으로 표시하자"
- 명확한 시각적 구분
- 실제 = 주황색, 예정 = 흰색
- 직관적인 UX

---

## 테스트 시나리오

### TC-001: 빈 달 확인
1. 11월로 이동
2. 근로기록 없음
3. **예상**: 모두 흰색 ✅

### TC-002: 근로기록 입력
1. 11월 5일 6시간 입력
2. **예상**: 5일만 주황색 ✅

### TC-003: 근로기록 삭제
1. 11월 데이터 삭제
2. **예상**: 
   - 캘린더 즉시 흰색 ✅
   - 통계 0으로 업데이트 ✅
   - "8건 삭제되었습니다" 메시지 ✅

### TC-004: 스케줄만 설정
1. 근로정보 수정에서 목, 금, 토 설정
2. 11월 확인
3. **예상**: 모두 흰색 (실제 근무 기록 없음) ✅

---

## 수정된 파일

1. **labor/services.py**
   - `monthly_scheduled_dates()` 함수
   - 스케줄 기반 로직 완전 제거
   - 실제 근로기록만 확인

---

## 최종 결론

✅ **문제 완전 해결!**

이제 11월 데이터를 삭제하면:
1. 캘린더가 즉시 흰색으로 변경됨
2. 통계가 즉시 0으로 업데이트됨
3. "삭제할 데이터가 없습니다" 메시지가 정확함
4. 모든 것이 일관되고 명확함

---

## 업데이트 날짜
2025년 12월 17일 (v3 최종)
