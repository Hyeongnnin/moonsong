import{d as L,i as W,j as A,o as B,y as O,c as y,b as t,F as Y,t as G,e as j,x as M,l as m,H as N,n as K,h as f,r as x,g as C,s as T,k as Q,p as k,v as b,m as X,A as Z,w as ee,M as te}from"./index-Cnd5pVle.js";import{u as ae,a as se}from"./MainLayout-DakwnOBK.js";import{a as S}from"./api-DXNNeTpL.js";import{T as J}from"./TimeSelect-BN2NVOPx.js";import{_ as le}from"./userStore-CmHVLOsv.js";const oe={class:"space-y-4"},re={class:"grid grid-cols-1 gap-3"},ne={class:"w-20 text-sm font-medium"},de={class:"ml-2 inline-flex items-center gap-2 text-sm cursor-pointer select-none"},ie=["onUpdate:modelValue"],ue=L({__name:"WeeklyScheduleEditor",props:{employeeId:{type:Number,required:!1}},setup(q,{expose:u}){const c=q,V=[{value:0,label:"월"},{value:1,label:"화"},{value:2,label:"수"},{value:3,label:"목"},{value:4,label:"금"},{value:5,label:"토"},{value:6,label:"일"}],$=W(()=>{const o=[];for(let r=0;r<24;r++){const l=String(r).padStart(2,"0");o.push(`${l}:00`),o.push(`${l}:30`)}return o}),i=A({0:{start_time:null,end_time:null,enabled:!1},1:{start_time:null,end_time:null,enabled:!1},2:{start_time:null,end_time:null,enabled:!1},3:{start_time:null,end_time:null,enabled:!1},4:{start_time:null,end_time:null,enabled:!1},5:{start_time:null,end_time:null,enabled:!1},6:{start_time:null,end_time:null,enabled:!1}});function U(o){if(!o)return null;const r=o.split(":");if(r.length<2)return null;let l=parseInt(r[0],10),n=parseInt(r[1],10);return n<15?n=0:n<45?n=30:(n=0,l+=1),l>=24&&(l=0),`${String(l).padStart(2,"0")}:${String(n).padStart(2,"0")}`}async function a(){try{if(!c.employeeId)return;const o=await S.get(`/labor/jobs/${c.employeeId}/schedules/`);_();for(const r of o.data){const l=parseInt(r.weekday);if(Number.isNaN(l))continue;const n=U(r.start_time),h=U(r.end_time);i[l]={start_time:n,end_time:h,enabled:!!r.enabled}}}catch(o){console.error("Failed to load schedules",o)}}async function w(){if(!c.employeeId){alert("먼저 알바 정보를 저장한 다음 스케줄을 저장하세요.");return}try{const o=V.map(r=>{const l=i[r.value],n={weekday:r.value,start_time:l.enabled?l.start_time:null,end_time:l.enabled?l.end_time:null,enabled:l.enabled};return S.post(`/labor/jobs/${c.employeeId}/schedules/`,n)});await Promise.all(o)}catch(o){throw console.error("Failed to save schedules",o),o}}function _(){for(const o of Object.keys(i))i[parseInt(o)].start_time=null,i[parseInt(o)].end_time=null,i[parseInt(o)].enabled=!1}return B(()=>{c.employeeId&&a()}),O(()=>c.employeeId,(o,r)=>{o&&o!==r?a():o||_()}),u({saveSchedules:w,loadSchedules:a}),(o,r)=>(f(),y("div",oe,[r[1]||(r[1]=t("p",{class:"text-sm text-gray-600"},"주간 근무 스케줄을 입력하세요. 각 요일에 대해 출근/퇴근 시간을 30분 단위로 설정합니다.",-1)),t("div",re,[(f(),y(Y,null,G(V,l=>t("div",{key:l.value,class:"flex items-center gap-3"},[t("div",ne,M(l.label),1),j(J,{modelValue:i[l.value].start_time,"onUpdate:modelValue":n=>i[l.value].start_time=n,options:$.value,disabled:!i[l.value].enabled},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),r[0]||(r[0]=t("span",{class:"text-xs text-gray-400"},"~",-1)),j(J,{modelValue:i[l.value].end_time,"onUpdate:modelValue":n=>i[l.value].end_time=n,options:$.value,disabled:!i[l.value].enabled},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),t("label",de,[m(t("input",{type:"checkbox","onUpdate:modelValue":n=>i[l.value].enabled=n,class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,8,ie),[[N,i[l.value].enabled]]),t("span",{class:K(i[l.value].enabled?"text-gray-900":"text-gray-400")},"활성",2)])])),64))]),t("div",{class:"flex gap-2 justify-end mt-4"},[t("button",{onClick:_,class:"px-4 py-2 text-sm text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors"},"초기화"),t("button",{onClick:w,class:"px-4 py-2 text-sm text-white bg-brand-600 rounded hover:bg-brand-700 transition-colors"},"저장")])]))}}),pe={class:"max-w-2xl mx-auto"},me={key:0,class:"mb-4 p-4 bg-brand-50 border border-brand-200 rounded-lg text-sm text-brand-700"},ce={class:"bg-white rounded-lg border border-gray-200 p-8 shadow-sm"},_e={class:"mb-6"},be={class:"mb-6"},ye={class:"mb-6"},fe={class:"mb-6"},ge={class:"mb-6"},ve={class:"relative"},xe={class:"mb-6"},we={class:"relative"},he={class:"mb-6"},ke={class:"relative"},Se={class:"mb-6"},Ve={class:"mb-6"},$e={class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ue={class:"flex items-center gap-3"},Ee={class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ie={class:"flex items-center gap-3"},Fe={class:"mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ne={class:"flex items-center gap-3"},je={class:"mb-6"},Ce={key:0,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg"},Te={class:"text-red-700 text-sm"},Me={class:"flex gap-3 justify-end"},qe=["disabled"],De={key:0},Je={key:1},Le={key:0,class:"fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg"},Ae=L({__name:"LaborEdit",setup(q){const{activeJob:u,fetchJobs:c,setActiveJob:V}=ae(),{fetchJobSummary:$,getMonthString:i,fetchEvaluation:U}=se(),a=A({workplace_name:"",workplace_address:"",workplace_reg_no:"",industry:"",employment_type:"",start_date:"",end_date:"",hourly_rate:0,weekly_hours:0,daily_hours:0,has_paid_weekly_holiday:!0,is_severance_eligible:!1,is_current:!0,work_days_per_week:null,attendance_rate_last_year:null,total_wage_last_3m:null,total_days_last_3m:null}),w=x(!1),_=x(!1),o=x(null),r=x(null),l=x(!1),n=x(null);async function h(){var d,e;w.value=!0;try{if(u.value){const s=(await S.get(`/labor/employees/${u.value.id}/`)).data;a.workplace_name=s.workplace_name||"",a.workplace_address=s.workplace_address||"",a.workplace_reg_no=s.workplace_reg_no||"",a.industry=s.industry||"",a.employment_type=s.employment_type||"",a.start_date=s.start_date||"",a.end_date=s.end_date||"",a.hourly_rate=parseFloat(s.hourly_rate)||0,a.weekly_hours=parseFloat(s.weekly_hours)||0,a.daily_hours=parseFloat(s.daily_hours)||0,a.has_paid_weekly_holiday=s.has_paid_weekly_holiday??!0,a.is_severance_eligible=s.is_severance_eligible??!1,a.is_current=s.is_current??!0,a.work_days_per_week=s.work_days_per_week??null,a.attendance_rate_last_year=s.attendance_rate_last_year??null,a.total_wage_last_3m=s.total_wage_last_3m??null,a.total_days_last_3m=s.total_days_last_3m??null}else o.value=null}catch(p){o.value=((e=(d=p.response)==null?void 0:d.data)==null?void 0:e.detail)||"근로정보를 불러올 수 없습니다.",console.error("Failed to load form data:",p)}finally{w.value=!1}}function E(d){return String(d).padStart(2,"0")}function D(d){if(!d)return null;if(d=d.trim(),/^\d{4}-\d{2}-\d{2}$/.test(d))return d;const e=d.match(/(\d{4}).*?(\d{1,2}).*?(\d{1,2})/);if(e){const s=e[1],g=E(e[2]),v=E(e[3]);return`${s}-${g}-${v}`}const p=new Date(d);if(!isNaN(p.getTime())){const s=p.getFullYear(),g=E(p.getMonth()+1),v=E(p.getDate());return`${s}-${g}-${v}`}return null}async function R(){var d,e,p;r.value=null,_.value=!0;try{const s={workplace_name:a.workplace_name,workplace_address:a.workplace_address,workplace_reg_no:a.workplace_reg_no,industry:a.industry,employment_type:a.employment_type,hourly_rate:a.hourly_rate,weekly_hours:a.weekly_hours,daily_hours:a.daily_hours,has_paid_weekly_holiday:a.has_paid_weekly_holiday,is_severance_eligible:a.is_severance_eligible,is_current:a.is_current,work_days_per_week:a.work_days_per_week,attendance_rate_last_year:a.attendance_rate_last_year,total_wage_last_3m:a.total_wage_last_3m,total_days_last_3m:a.total_days_last_3m},g=D(a.start_date),v=D(a.end_date);if(s.start_date=g,s.end_date=v,u.value){await S.patch(`/labor/employees/${u.value.id}/`,s);try{n.value&&await n.value.saveSchedules()}catch(I){console.warn("스케줄 저장 중 오류 발생:",I)}}else{const F=(await S.post("/labor/employees/",s)).data;await c(),F!=null&&F.id&&(V(F.id),setTimeout(async()=>{try{n.value&&await n.value.saveSchedules()}catch(P){console.warn("스케줄 저장 중 오류 발생:",P)}},100))}l.value=!0,setTimeout(()=>{l.value=!1},3e3),await c();const H=i();u.value&&await $(u.value.id,H);try{u.value&&await U(u.value.id)}catch(I){console.warn("평가 결과 재조회 실패",I)}window.dispatchEvent(new CustomEvent("job-updated")),console.log("근로정보 저장 및 평가 갱신 완료")}catch(s){console.error("Failed to save employee data:",s);const g=(e=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:e.detail,v=(p=s==null?void 0:s.response)!=null&&p.data&&typeof s.response.data=="object"?Object.values(s.response.data).flat().join(", "):"";r.value=g||v||"저장에 실패했습니다. 서버 연결 또는 인증을 확인해주세요."}finally{_.value=!1}}function z(){h()}return B(()=>{h()}),O(u,(d,e)=>{(d&&!e||d&&e&&d.id!==e.id||!d&&e)&&h()}),(d,e)=>{var p;return f(),y("div",pe,[e[32]||(e[32]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"근로정보 수정"),t("p",{class:"text-sm text-gray-600"},"현재 선택된 알바의 근로조건을 수정할 수 있습니다.")],-1)),T(u)?C("",!0):(f(),y("div",me," 현재 선택된 알바가 없습니다. 아래 폼을 작성하면 새 알바가 등록되고 자동으로 선택됩니다. ")),t("div",ce,[t("form",{onSubmit:Q(R,["prevent"])},[t("div",_e,[e[12]||(e[12]=t("label",{for:"workplace_name",class:"block text-sm font-semibold text-gray-900 mb-2"},[k(" 사업장명 "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{id:"workplace_name","onUpdate:modelValue":e[0]||(e[0]=s=>a.workplace_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: Starbucks 강남점"},null,512),[[b,a.workplace_name]])]),t("div",be,[e[13]||(e[13]=t("label",{for:"workplace_address",class:"block text-sm font-semibold text-gray-900 mb-2"}," 사업장 주소 ",-1)),m(t("input",{id:"workplace_address","onUpdate:modelValue":e[1]||(e[1]=s=>a.workplace_address=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 서울시 강남구"},null,512),[[b,a.workplace_address]])]),t("div",ye,[e[14]||(e[14]=t("label",{for:"industry",class:"block text-sm font-semibold text-gray-900 mb-2"}," 업종 ",-1)),m(t("input",{id:"industry","onUpdate:modelValue":e[2]||(e[2]=s=>a.industry=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 음식료, 소매, 교육"},null,512),[[b,a.industry]])]),t("div",fe,[e[16]||(e[16]=t("label",{for:"employment_type",class:"block text-sm font-semibold text-gray-900 mb-2"},[k(" 고용형태 "),t("span",{class:"text-red-500"},"*")],-1)),m(t("select",{id:"employment_type","onUpdate:modelValue":e[3]||(e[3]=s=>a.employment_type=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},[...e[15]||(e[15]=[Z('<option value="" data-v-74da37cf>-- 선택하세요 --</option><option value="알바" data-v-74da37cf>알바</option><option value="정규직" data-v-74da37cf>정규직</option><option value="계약직" data-v-74da37cf>계약직</option><option value="프리랜서" data-v-74da37cf>프리랜서</option><option value="기타" data-v-74da37cf>기타</option>',6)])],512),[[X,a.employment_type]])]),t("div",ge,[e[18]||(e[18]=t("label",{for:"hourly_rate",class:"block text-sm font-semibold text-gray-900 mb-2"},[k(" 시급 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ve,[m(t("input",{id:"hourly_rate","onUpdate:modelValue":e[4]||(e[4]=s=>a.hourly_rate=s),type:"number",required:"",min:"0",step:"100",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 11500"},null,512),[[b,a.hourly_rate,void 0,{number:!0}]]),e[17]||(e[17]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"원",-1))])]),t("div",xe,[e[20]||(e[20]=t("label",{for:"weekly_hours",class:"block text-sm font-semibold text-gray-900 mb-2"},[k(" 주당 근로시간 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",we,[m(t("input",{id:"weekly_hours","onUpdate:modelValue":e[5]||(e[5]=s=>a.weekly_hours=s),type:"number",required:"",min:"0",max:"168",step:"0.5",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 30"},null,512),[[b,a.weekly_hours,void 0,{number:!0}]]),e[19]||(e[19]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"시간",-1))])]),t("div",he,[e[22]||(e[22]=t("label",{for:"daily_hours",class:"block text-sm font-semibold text-gray-900 mb-2"}," 1일 근로시간 ",-1)),t("div",ke,[m(t("input",{id:"daily_hours","onUpdate:modelValue":e[6]||(e[6]=s=>a.daily_hours=s),type:"number",min:"0",max:"24",step:"0.5",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 8"},null,512),[[b,a.daily_hours,void 0,{number:!0}]]),e[21]||(e[21]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"시간",-1))])]),t("div",Se,[e[23]||(e[23]=t("label",{for:"start_date",class:"block text-sm font-semibold text-gray-900 mb-2"},[k(" 근로 시작일 "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{id:"start_date","onUpdate:modelValue":e[7]||(e[7]=s=>a.start_date=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},null,512),[[b,a.start_date]])]),t("div",Ve,[e[24]||(e[24]=t("label",{for:"end_date",class:"block text-sm font-semibold text-gray-900 mb-2"}," 근로 종료일 ",-1)),m(t("input",{id:"end_date","onUpdate:modelValue":e[8]||(e[8]=s=>a.end_date=s),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},null,512),[[b,a.end_date]]),e[25]||(e[25]=t("p",{class:"text-xs text-gray-500 mt-1"},"현재 재직 중인 경우 비워두세요.",-1))]),t("div",$e,[t("div",Ue,[m(t("input",{id:"has_paid_weekly_holiday","onUpdate:modelValue":e[9]||(e[9]=s=>a.has_paid_weekly_holiday=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[N,a.has_paid_weekly_holiday]]),e[26]||(e[26]=t("label",{for:"has_paid_weekly_holiday",class:"text-sm font-medium text-gray-900"}," 주휴수당 대상 ",-1)),e[27]||(e[27]=t("p",{class:"text-xs text-gray-500 ml-auto"},"주 1일 이상 근무 시 적용",-1))])]),t("div",Ee,[t("div",Ie,[m(t("input",{id:"is_severance_eligible","onUpdate:modelValue":e[10]||(e[10]=s=>a.is_severance_eligible=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[N,a.is_severance_eligible]]),e[28]||(e[28]=t("label",{for:"is_severance_eligible",class:"text-sm font-medium text-gray-900"}," 퇴직금 대상 ",-1)),e[29]||(e[29]=t("p",{class:"text-xs text-gray-500 ml-auto"},"1년 이상 근무 시 적용",-1))])]),t("div",Fe,[t("div",Ne,[m(t("input",{id:"is_current","onUpdate:modelValue":e[11]||(e[11]=s=>a.is_current=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[N,a.is_current]]),e[30]||(e[30]=t("label",{for:"is_current",class:"text-sm font-medium text-gray-900"}," 현재 재직 중 ",-1))])]),t("div",je,[e[31]||(e[31]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-2"},"주간 근무 스케줄",-1)),j(ue,{ref_key:"weeklyScheduleEditorRef",ref:n,employeeId:(p=T(u))==null?void 0:p.id},null,8,["employeeId"])]),r.value?(f(),y("div",Ce,[t("p",Te,M(r.value),1)])):C("",!0),t("div",Me,[t("button",{type:"button",onClick:z,class:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200"}," 취소 "),t("button",{type:"submit",disabled:_.value,class:"px-6 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2"},[_.value?(f(),y("span",Je,"저장 중...")):(f(),y("span",De,M(T(u)?"저장하기":"등록하고 선택하기"),1))],8,qe)])],32)]),j(te,{name:"fade"},{default:ee(()=>[l.value?(f(),y("div",Le," 저장되었습니다! ")):C("",!0)]),_:1})])}}}),Pe=le(Ae,[["__scopeId","data-v-74da37cf"]]);export{Pe as default};
